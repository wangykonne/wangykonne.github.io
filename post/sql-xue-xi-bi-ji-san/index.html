<html>
<head>
    <meta charset="utf-8" />
<meta name="description" content="" />
<meta name="viewport" content="width=device-width, initial-scale=1" />

<title>SQL学习笔记（三） | db自留地</title>

<link rel="shortcut icon" href="https://wangykonne.github.io/favicon.ico?v=1615704908791">

<link href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free/css/all.min.css" rel="stylesheet">
<link rel="stylesheet" href="https://wangykonne.github.io/styles/main.css">
<!-- <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.5.0/dist/css/bootstrap.min.css"> -->

<style>
    hr {
        margin-top: 1rem;
        margin-bottom: 1rem;
        border: 0;
        border-top: 1px solid rgba(0, 0, 0, 0.1);
    }
</style>

<script src="https://cdn.jsdelivr.net/npm/@highlightjs/cdn-assets/highlight.min.js"></script>
<script src="https://cdn.bootcss.com/highlight.js/9.15.10/languages/dockerfile.min.js"></script>
<script src="https://cdn.bootcss.com/highlight.js/9.15.10/languages/dart.min.js"></script>

<!-- <script src="https://cdn.jsdelivr.net/npm/moment@2.27.0/moment.min.js"></script> -->
<!-- <script src="https://cdn.jsdelivr.net/npm/jquery@3.5.1/dist/jquery.slim.min.js"></script> -->
<!-- <script src="https://cdn.jsdelivr.net/npm/popper.js@1.16.0/dist/umd/popper.min.js"></script> -->
<!-- <script src="https://cdn.jsdelivr.net/npm/bootstrap@4.5.0/dist/js/bootstrap.min.js"></script> -->
<!-- DEMO JS -->
<!--<script src="media/scripts/index.js"></script>-->


    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.12.0/dist/katex.css">
</head>
<body>
<div class="main gt-bg-theme-color-first">
    <style>
    /* 导航栏样式 */
    .navbar {
        position: relative;
        display: -ms-flexbox;
        display: flex;
        -ms-flex-wrap: wrap;
        flex-wrap: wrap;
        -ms-flex-align: center;
        align-items: center;
        -ms-flex-pack: justify;
        justify-content: space-between;
        padding: 0.5rem 1rem;
    }

    .navbar-brand {
        display: inline-block;
        padding-top: 0.3125rem;
        padding-bottom: 0.3125rem;
        margin-right: 1rem;
        font-size: 1.25rem;
        line-height: inherit;
        white-space: nowrap;
    }

    .navbar-brand:hover,
    .navbar-brand:focus {
        text-decoration: none;
    }

    .navbar-nav {
        display: -ms-flexbox;
        display: flex;
        -ms-flex-direction: column;
        flex-direction: column;
        padding-left: 0;
        margin-bottom: 0;
        list-style: none;
    }

    .navbar-collapse {
        -ms-flex-preferred-size: 100%;
        flex-basis: 100%;
        -ms-flex-positive: 1;
        flex-grow: 1;
        -ms-flex-align: center;
        align-items: center;
    }

    .navbar-toggler {
        padding: 0.25rem 0.75rem;
        font-size: 1.25rem;
        line-height: 1;
        background-color: transparent;
        border: 1px solid transparent;
        border-radius: 0.25rem;
    }

    .navbar-toggler:hover,
    .navbar-toggler:focus {
        text-decoration: none;
    }

    @media (min-width: 992px) {
        .navbar-expand-lg {
            -ms-flex-flow: row nowrap;
            flex-flow: row nowrap;
            -ms-flex-pack: start;
            justify-content: flex-start;
        }

        .navbar-expand-lg .navbar-nav {
            -ms-flex-direction: row;
            flex-direction: row;
        }

        .navbar-expand-lg .navbar-collapse {
            display: -ms-flexbox !important;
            display: flex !important;
            -ms-flex-preferred-size: auto;
            flex-basis: auto;
        }

        .navbar-expand-lg .navbar-toggler {
            display: none;
        }
    }

    @media (max-width: 991px) {
        #navbarSupportedContent {
            display: none;
        }
    }
</style>
<nav class="navbar navbar-expand-lg">
    <div class="navbar-brand">
        <img class="user-avatar" src="/images/avatar.png" alt="头像">
        <div class="site-name gt-c-content-color-first">
            db自留地
        </div>
    </div>
    <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarSupportedContent"
        aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
        <i class="fas fa-bars gt-c-content-color-first" style="font-size: 18px"></i>
    </button>
    <div class="collapse navbar-collapse" id="navbarSupportedContent">
        <div class="navbar-nav mr-auto" style="text-align: center">
            
            <div class="nav-item">
                
                <a href="/" class="menu gt-a-link">
                    首页
                </a>
                
            </div>
            
            <div class="nav-item">
                
                <a href="/archives" class="menu gt-a-link">
                    归档
                </a>
                
            </div>
            
            <div class="nav-item">
                
                <a href="/tags" class="menu gt-a-link">
                    标签
                </a>
                
            </div>
            
            <div class="nav-item">
                
                <a href="/post/about" class="menu gt-a-link">
                    关于
                </a>
                
            </div>
            
        </div>
        <div style="text-align: center">
            <form id="gridea-search-form" style="position: relative" data-update="1615704908791"
                action="/search/index.html">
                <input class="search-input" autocomplete="off" spellcheck="false" name="q" placeholder="搜索文章" />
                <i class="fas fa-search gt-c-content-color-first" style="position: absolute; top: 9px; left: 10px;"></i>
            </form>
        </div>
    </div>
</nav>
<script>
    /* 移动端导航栏展开/收起切换 */
    document.getElementById('changeNavbar').onclick = function () {
        var element = document.getElementById('navbarSupportedContent');
        if (element.style.display === 'none' || element.style.display === '') {
            element.style.display = 'block';
        } else {
            element.style.display = 'none';
        }
    }
</script>
    <div class="post-container">
        <div class="post-detail gt-bg-theme-color-second">
            <article class="gt-post-content">
                <h2 class="post-title">
                    SQL学习笔记（三）
                </h2>
                <div class="post-info">
                    <time class="post-time gt-c-content-color-first">
                        · 2020-12-17 ·
                    </time>
                    
                        <a href="https://wangykonne.github.io/tag/5kDrY3mnW/" class="post-tags">
                            # SQL基础知识
                        </a>
                    
                </div>
                <div class="post-content">
                    <blockquote>
<p>学习用书：SQL基础教程（Mick著） 数据库：MySQL 数据库可视化软件：SQLyog</p>
</blockquote>
<!-- more -->
<h1 id="第二章查询基础">第二章：查询基础</h1>
<h2 id="23-逻辑运算符">2.3 逻辑运算符</h2>
<h3 id="231-not运算符">2.3.1 NOT运算符</h3>
<p>  NOT运算符比较好理解，就是表示&quot;非&quot;的意思，使用范围比不等号&lt;&gt;要广，例如想要选择销售单价小于1000的商品时，就可以用NOT语句：</p>
<p><code>#使用NOT查询sale_price小于1000的行的product_name,product_type,sale_price值</code><br>
<code>SELECT product_name, product_type, sale_price</code><br>
<code>FROM Product</code><br>
<code>WHERE NOT sale_price &gt;= 1000;</code></p>
<p>  虽然直接用&lt;1000可以不用使用NOT，但上面例子只是展示一下用法，NOT语句在复杂的语法中会发挥它的作用。</p>
<h3 id="232-and运算符和or运算符">2.3.2 AND运算符和OR运算符</h3>
<p>  实际生活中，往往查询中不止一个限制条件，此时就可以使用AND和OR运算符，分别表示且、或的概念。例如，想查询商品种类为厨房用品且销售单价大于等于3000的商品，可以使用AND：</p>
<p><code>#查询product_type为'厨房用具'且sale_price不小于3000的行的product_name,purchase_price</code><br>
<code>SELECT product_name, purchase_price</code><br>
<code>FROM Product</code><br>
<code>WHERE product_type = '厨房用具'</code><br>
<code>AND sale_price &gt;= 3000;</code></p>
<p>  想查询商品种类为厨房用品或者销售单价大于等于3000的商品，可以使用OR：</p>
<p><code>#查询product_type为'厨房用具'或者sale_price不小于3000的行的product_name,purchase_price</code><br>
<code>SELECT product_name, purchase_price</code><br>
<code>FROM Product</code><br>
<code>WHERE product_type = '厨房用具'</code><br>
<code>OR sale_price &gt;= 3000;</code></p>
<h3 id="233-通过括号强化处理">2.3.3 通过括号强化处理</h3>
<p>  需要注意的是，AND运算符的优先级高于OR运算符，如果在混合使用中，可能会引起歧义，这时最好使用括号进行处理。例如想要查询商品种类为办公用品，并且，登记日期为2009-9-11或2009-9-20的商品：</p>
<p><code>#查询product_type为'办公用品'且regist_date为'2009-09-11'或'2009-09-20'的行的product_name,product_type,regist_date</code><br>
<code>SELECT product_name, product_type, regist_date</code><br>
<code>FROM Product</code><br>
<code>WHERE product_type = '办公用品'</code><br>
<code>AND (regist_date = '2009-09-11'</code><br>
<code>OR regist_date = '2009-09-20');</code></p>
<p>  上面的语句中，如果把括号去掉，会返回不一样的结果，因为AND的运算优先级高于OR，SQL会理解为&quot;product_type = '办公用品' AND regist_date = '2009-09-11'&quot; OR &quot;regist_date = '2009-09-20'&quot;。所以在混合使用时要注意使用括号。</p>
<h3 id="234-含有null时的真值">2.3.4 含有NULL时的真值</h3>
<p>  在SQL中，逻辑运算符的结果除了TRUE和FALSE外，还有一个UNKNOWN，表示不确定值。即NULL值在和真假值进行AND和OR运算时，会产生UNKNOWN值，具体运算规则比较简单，直接想想就懂了。</p>
<h1 id="第三章聚合与排序">第三章：聚合与排序</h1>
<h2 id="31-对表进行聚合排序">3.1 对表进行聚合排序</h2>
<h3 id="311-聚合函数">3.1.1 聚合函数</h3>
<p>  通过SQL对数据某些操作时需要使用函数。下面是5个基本的函数：<br>
  COUNT：记录表中的行数（数据数）<br>
  SUM：计算表中数据的各列的数据的总值。<br>
  AVG：计算表中数据的各列的平均值。<br>
  MAX：计算表中数据的各列的最大值。<br>
  MIN：计算表中数据的各列的最小值。</p>
<h3 id="312-计算表中数据的行数">3.1.2 计算表中数据的行数</h3>
<p>  使用COUNT函数可以计算表中数据的行数，例如计算表中数据一共有多少行：</p>
<p><code>#查询全部数据的行数</code><br>
<code>SELECT COUNT(*)</code><br>
<code>FROM Product;</code></p>
<h3 id="313-计算除null值以外的数据的行数">3.1.3 计算除NULL值以外的数据的行数</h3>
<p>  例如purchase_price列中含有NULL值，所以使用COUNT进行查询时，会返回非NULL值的行数：</p>
<p><code>#查询purchase_price列中非NULL的行数</code><br>
<code>SELECT COUNT(purchase_price)</code><br>
<code>FROM Product;</code></p>
<p>  需要注意一个特殊情况，例如一个只有一列的表，其三行数据均为NULL，则用COUNT(*)查询时会返回3，但使用COUNT(列名)查询时会返回0！原因很简单，就是COUNT函数的原理问题，就不多介绍了。</p>
<h3 id="314-计算合计值">3.1.4 计算合计值</h3>
<p>  使用SUM函数可以得到指定列的数据总值，例如求sale_price,purchase_price列的数据总和：</p>
<p><code>#查询sale_price,purchase_price列的数据总和</code><br>
<code>SELECT SUM(sale_price), SUM(purchase_price)</code><br>
<code>FROM Product;</code></p>
<p>  需要注意的是，purchase_price中含有NULL值，为什么还会返回出计算的正确结果呢，按照昨天的学习NULL值进行四则运算一定会得到NULL值。原因是所有的聚合函数在以列名为参数时会自动先把NULL值的行排除在外，所以即使列内有NULL值也能使用聚合函数得到对应的结果。</p>
<h3 id="315-计算平均值">3.1.5 计算平均值</h3>
<p>  使用AVG函数可以计算指定列的数据的平均值，例如求sale_price,purchase_price列的数据平均值：</p>
<p><code>#查询sale_price,purchase_price列的数据平均值</code><br>
<code>SELECT AVG(sale_price), AVG(purchase_price)</code><br>
<code>FROM Product;</code></p>
<p>  上面说到，聚合函数以列名为参数时会忽略NULL值，所以此时计算平均数的分母也会发生变化，例如purchase_price中非NULL值为6行，所以平均值计算会除以6而不是除以8。当然也有方法把NULL视为0然后除以8计算平均值，这种方法会在第六章介绍。</p>
<h3 id="316-计算最大值和最小值">3.1.6 计算最大值和最小值</h3>
<p>  使用MIN和MAX可以得到指定列的数据最大值和最小值，例如求sale_price的最小值和purchase_price的最大值：</p>
<p><code>#查询sale_price的最小值和purchase_price的最大值</code><br>
<code>SELECT MIN(sale_price), MAX(purchase_price)</code><br>
<code>FROM Product;</code></p>
<p>  需要注意的是，MAX/MIN函数和SUM/AVG函数有一点不同，SUM/AVG函数只能对数值类型的列使用，但MAX/MIN函数原则上可以适用于任何类型的数据列，例如如果对字符串类型则会按字典排序的方法选择最大值和最小值：</p>
<p><code>#查询登记日期的最大值和最小值</code><br>
<code>SELECT MIN(regist_date), MAX(regist_date)</code><br>
<code>FROM Product;</code></p>
<h3 id="317-使用聚合函数删除重复值">3.1.7 使用聚合函数删除重复值</h3>
<p>  聚合函数和DISTINCT函数结合使用，如想知道一个列有几种不同的值：</p>
<p><code>#查询product_type总共有多少种不同的取值</code><br>
<code>SELECT COUNT(DISTINCT product_type)</code><br>
<code>FROM Product;</code></p>
<p>  其他聚合函数和DISTINCT的用法类似，注意DISTINCT要放在聚合函数的括号内。</p>
<h2 id="32-对表进行分组">3.2 对表进行分组</h2>
<h3 id="321-group-by子句">3.2.1 GROUP BY子句</h3>
<p>  前面所学的各种语句都是对表中的所有数据进行的汇总处理。而使用GROUP BY语句可以将表分为多个组再进行汇总处理，例如，想按照商品种类来统计一下数据的行数：</p>
<p><code>#按product_type查询数据的行数</code><br>
<code>SELECT product_type, COUNT(*)</code><br>
<code>FROM Product</code><br>
<code>GROUP BY product_type;</code></p>
<p>  GROUP BY子句中指定的列成为聚合键或者分组列，如上product_type有三种不同的类型故最后查询的结果分别为这三种类型的各自行数。同样GROUP BY也可以通过逗号分割指定多列。最后GROUP BY子句的书写位置有固定的规则，一定要写在FROM语句后面，而如果还有WHERE语句那就要在WHERE语句之后。目前学习的语法顺序暂定为：<br>
  SELECT➡FROM➡WHERE➡GROUP BY</p>
<h3 id="322-聚合键中包含null的情况">3.2.2 聚合键中包含NULL的情况</h3>
<p>  purchase_price中含有两个NULL，所以我们用它做GROUP BY实验，看会得到怎样的结果：</p>
<p><code>#按照purchase_price统计数据行数</code><br>
<code>SELECT purchase_price, COUNT(*)</code><br>
<code>FROM Product</code><br>
<code>GROUP BY purchase_price;</code></p>
<p>  上面的结果会将NULL也视为一个类别，即不确定，会在表中以空行的形式展现出来。</p>
<h3 id="323-同时使用where语句和group-by语句">3.2.3 同时使用WHERE语句和GROUP BY语句</h3>
<p>  同时使用WHERE和GROUP BY子句时，会先用WHERE语句对数据进行过滤，再按照GROUP BY进行汇总处理，例如查询商品类别为衣服的数据并按照进货价格分类，显示其进货价格和数据量：</p>
<p><code>#查询商品类别为衣服的数据并按照进货价格分类，显示其进货价格和数据量：</code><br>
<code>SELECT purchase_price, COUNT(*)</code><br>
<code>FROM Product</code><br>
<code>WHERE product_type = '衣服'</code><br>
<code>GROUP BY purchase_price;</code></p>
<p>  上面代码的执行顺序为：FROM→WHERE→GROUP BY→SELECT</p>
<h3 id="324-与聚合函数和group-by子句有关的常见错误">3.2.4 与聚合函数和GROUP BY子句有关的常见错误</h3>
<p><strong>常见错误①：在SELECT子句中书写了不在聚合键中的列。</strong><br>
  在使用COUNT这样的聚合函数时，SELECT子句的元素有很强的限制，只能存在以下三种成分：①常数，②聚合函数，③GROUP BY子句中指定的列名。下面给出一个错误的例子：</p>
<p><code>#常见错误①的例子</code><br>
<code>SELECT product_name, purchase_price, COUNT(*)</code><br>
<code>FROM Product</code><br>
<code>GROUP BY purchase_price;</code></p>
<p>  上面的代码中，SELECT语句的product_name没有包含在聚合键GROUP BY中，会出现错误。不支持这种语法的原因其实很好理解，因为按照GROUP BY分类后，类别数肯定是小于等于没分类的product_nam的行数的，这样表格就不是一对一的了，会出现问题，所以这种语法被禁止。</p>
<p><strong>常见错误②：在GROUP BY子句中写了列的别名。</strong><br>
  前面说过用SELECT AS 可以给列取别名，但如果在GROUP BY中使用这个别名来调用列就会出现错误：</p>
<p><code>#常见错误②的例子</code><br>
<code>SELECT purchase_price AS pp, COUNT(*)</code><br>
<code>FROM Product</code><br>
<code>GROUP BY pp;</code></p>
<p>  <strong>注意：上面的代码并非在所有RDBMS中都会产生错误，在PostgreSQL和MySQL中上面的语句是可以执行的，而在其他的RDBMS中则不能执行</strong>。在一些RDBMS中上面语句不能执行的原因很简单，就和之前说的语句执行顺序有关，GROUP BY会先于SELECT语句执行，故在SELECT中的别名不会被GROUP BY识别。尽管这种错误跟不同软件有关，但最好还是不要用这种语法了。</p>
<p><strong>常见错误③：在WHERE语句中使用聚合函数。</strong><br>
  先看一个正确的例子，按照商品类别进行分类：</p>
<p><code>#按照商品类别进行分类并查询各类别的行数</code><br>
<code>SELECT product_type, COUNT(*)</code><br>
<code>FROM Product</code><br>
<code>GROUP BY product_type;</code></p>
<p>  上面的代码的结果会返回三行数据，其中衣服和办公用品的COUNT都是2，厨房用具的COUNT是4。此时如果我们想查询COUNT数恰好为2的数据该怎么办呢？下面是一个错误的例子：</p>
<p><code>#常见错误③的例子</code><br>
<code>SELECT product_type, COUNT(*)</code><br>
<code>FROM Product</code><br>
<code>WHERE COUNT(*) = 2</code><br>
<code>GROUP BY product_type;</code></p>
<p>  理所当然地在WHERE中加入COUNT=2的选择条件是不行的，因为WHERE语句中不能使用聚合函数，要达到上面这个问题的目的需要使用HAVING子句。HAVING语句会在明天的3.3节中介绍。计划明天将第三章完结并做课后习题。</p>

                </div>
            </article>
        </div>

        
            <div class="next-post">
                <div class="next gt-c-content-color-first">下一篇</div>
                <a href="https://wangykonne.github.io/post/sql-xue-xi-bi-ji-er/" class="post-title gt-a-link">
                    SQL学习笔记（二）
                </a>
            </div>
        

        

        

        
            <script src='https://cdn.jsdelivr.net/npm/valine/dist/Valine.min.js'></script>

<style>
	div#vcomments{
		width:100%;
		max-width: 1000px;
		padding: 2.5%
	}
</style>


	<div id="vcomments"></div>

<script>
	new Valine({
		el: '#vcomments',
		appId: 'aHb7wrt4LdY1y2xNnPnv8Bdf-9Nh9j0Va',
		appKey: '3ND7IFEdq0etn28alvpNtWLk',
		avatar: 'mp',
		pageSize: 5,
		recordIp: false,
		placeholder: 'Just Go Go',
		visitor: false,
	});
</script>

        

        <div class="site-footer gt-c-content-color-first">
    <div class="slogan gt-c-content-color-first">日近长安远</div>
    <div class="social-container">
        
            
        
            
        
            
        
            
        
            
        
            
        
    </div>
    <div class="footer-info">
        Powered by <a href="https://github.com/getgridea/gridea" target="_blank">Gridea</a>
    </div>
    <div>
        Theme by <a href="https://imhanjie.com/" target="_blank">imhanjie</a>, Powered by <a
                href="https://github.com/getgridea/gridea" target="_blank">Gridea | <a href="https://wangykonne.github.io/atom.xml" target="_blank">RSS</a></a>
    </div>
</div>

<script>
  hljs.initHighlightingOnLoad()
</script>

    </div>
</div>
</body>
</html>
